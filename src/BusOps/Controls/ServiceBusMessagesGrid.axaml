<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:BusOps.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="BusOps.Controls.ServiceBusMessagesGrid"
             x:Name="Root"
             x:DataType="controls:ServiceBusMessagesGrid"
             x:CompileBindings="True">
    
    <UserControl.Resources>
        <ControlTheme
            x:Key="GridHeaderCompatibleWithCenteredContent"
            BasedOn="{StaticResource {x:Type DataGridColumnHeader}}"
            TargetType="DataGridColumnHeader">
            <Setter Property="Padding" Value="12,0,12,0" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border
                        x:Name="HeaderBorder"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding CornerRadius}">
                        <Grid Name="PART_ColumnHeaderRoot" ColumnDefinitions="*,Auto">

                            <Panel HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                   VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <ContentPresenter
                                        x:Name="PART_ContentPresenter"
                                        Margin="{TemplateBinding Padding}"
                                        Content="{TemplateBinding Content}"
                                        ContentTemplate="{TemplateBinding ContentTemplate}" />

                                    <Path
                                        Name="SortIcon"
                                        Grid.Column="1"
                                        Height="12"
                                        MinWidth="20"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Fill="{TemplateBinding Foreground}"
                                        IsVisible="False"
                                        Stretch="Uniform" />
                                </Grid>
                            </Panel>

                            <Rectangle
                                Name="VerticalSeparator"
                                Grid.Column="1"
                                VerticalAlignment="Stretch"
                                Fill="{TemplateBinding SeparatorBrush}"
                                IsVisible="{TemplateBinding AreSeparatorsVisible}" />

                            <Grid
                                x:Name="FocusVisual"
                                IsHitTestVisible="False"
                                IsVisible="False">
                                <Rectangle
                                    x:Name="FocusVisualPrimary"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Fill="Transparent"
                                    IsHitTestVisible="False"
                                    Stroke="{DynamicResource DataGridCellFocusVisualPrimaryBrush}"
                                    StrokeThickness="2" />
                                <Rectangle
                                    x:Name="FocusVisualSecondary"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Fill="Transparent"
                                    IsHitTestVisible="False"
                                    Stroke="{DynamicResource DataGridCellFocusVisualSecondaryBrush}"
                                    StrokeThickness="1" />
                            </Grid>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter>
        </ControlTheme>
    </UserControl.Resources>
    <DataGrid ItemsSource="{Binding #Root.Messages}"
              SelectedItem="{Binding #Root.SelectedMessage}"
              IsReadOnly="True"
              GridLinesVisibility="All"
              BorderThickness="1"
              AutoGenerateColumns="False"
              CanUserResizeColumns="True"
              CanUserSortColumns="True"
              BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
              ColumnHeaderTheme="{DynamicResource GridHeaderCompatibleWithCenteredContent}">
        <DataGrid.Styles>
            <Style Selector="DataGridCell">
                <Setter Property="FontSize" Value="12"/>
            </Style>
            <Style Selector="DataGridColumnHeader">
                <Setter Property="Background" Value="{DynamicResource PrimaryBackgroundColor}" />
                <Setter Property="BorderThickness" Value="1"/>
            </Style>
        </DataGrid.Styles>
        <DataGrid.Columns>
            <!-- Checkbox Column with Select All Header -->
            <DataGridTemplateColumn Width="75">
                <DataGridTemplateColumn.Header>
                    <CheckBox 
                        IsChecked="{Binding $parent[controls:ServiceBusMessagesGrid].SelectAllChecked}"
                        Margin="0"
                        Padding="0"
                        ToolTip.Tip="Select All"
                        HorizontalAlignment="Center"
                        HorizontalContentAlignment="Center" />
                </DataGridTemplateColumn.Header>
                <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding IsSelected}"
                                  HorizontalAlignment="Center"
                                  Padding="0"/>
                    </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            
            <DataGridTextColumn Header="Message ID"
                                Binding="{Binding MessageId}"
                                Width="250"/>
            <DataGridTextColumn Header="Enqueued Time"
                                Binding="{Binding EnqueuedTime, StringFormat='{}{0:g}'}"
                                Width="150"/>
            <DataGridTextColumn Header="Correlation ID"
                                Binding="{Binding CorrelationId}"
                                Width="200"/>
            <DataGridTextColumn Header="Body"
                                Binding="{Binding Body}"
                                Width="*"/>
        </DataGrid.Columns>
    </DataGrid>
</UserControl>

